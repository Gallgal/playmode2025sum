<!DOCTYPE html>
<html lang="ko" class="use-fixed-bg">
<head>
<meta http-equiv="Content-Language" content="ko">
<link rel="canonical" href="https://어의실험극회.kr/">
<meta property="og:url" content="https://어의실험극회.kr/">
<meta property="og:image" content="https://어의실험극회.kr/resource/og-image.jpg">
    <meta charset='utf-8'>
<link rel="preload" as="image" href="./resource/after.jpeg">
<link rel="preload" as="image" href="./resource/before.jpeg">
<link rel="preload" as="image" href="./resource/night.jpeg">
<link rel="preload" as="image" href="./resource/after2.jpeg">
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name="color-scheme" content="light only"/>
	<meta name="supported-color-schemes" content="light"/>
    <title>청색편이</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name="theme-color" content="#113340">
      <link rel="icon" type="image/x-icon" href="./resource/footer.svg">
      <link rel="apple-touch-icon" href="./resource/footer.svg">

    <!-- Open Graph (for KakaoTalk, Facebook, etc.) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="청색편이">
    <meta property="og:title" content="청색편이 – 제92회 정기공연">
    <meta property="og:description" content="서울과학기술대학교 중앙연극동아리 어의실험극회 제92회 정기공연">
    <!-- NOTE: Prefer an absolute URL for best compatibility -->
    <meta property="og:image" content="https://어의실험극회.kr/resource/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="ko_KR">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="청색편이 – 제92회 정기공연">
    <meta name="twitter:description" content="서울과학기술대학교 중앙연극동아리 어의실험극회 제92회 정기공연">
    <!-- Same image as OG -->
    <meta name="twitter:image" content="./resource/og-image.jpg">

    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
     <style>
        /* Pretendard (Safari-safe): variable first, static fallbacks */
        @font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 100;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Thin.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Thin.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 200;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-ExtraLight.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-ExtraLight.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 300;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Light.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Light.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 400;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Regular.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Regular.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 500;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Medium.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Medium.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 600;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-SemiBold.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-SemiBold.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 700;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Bold.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Bold.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 800;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-ExtraBold.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-ExtraBold.ttf') format('truetype');
}
@font-face {
    font-family: 'Apple SD Gothic Neo';
    font-weight: 900;
    font-style: normal;
    font-display: swap;
    src: url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Black.woff2') format('woff2'),
         url('https://cdn.jsdelivr.net/gh/fonts-archive/AppleSDGothicNeo/AppleSDGothicNeo-Black.ttf') format('truetype');
}



html, body {
  height: 100%;
  margin: 0;
  min-width: 350px;
  scroll-behavior: smooth;
  background-color: #113340 !important;
  word-break: keep-all;
}

body {
  font-family: 'Pretendard', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
               'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', sans-serif;
  -webkit-font-smoothing: antialiased;     /* Safari/macOS */
  text-rendering: optimizeLegibility;
  font-synthesis: none;     
}

 




#section{position: absolute; width: 100vw; height: 100vh; margin: 0; overflow: hidden; z-index: 3; position: relative;}

.imgbg{
  width: 100vw;
  height: 100vh;
  margin: 0;
  background-size: cover;
  background-attachment: scroll;
  background-position: center;
}
#title{position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; 
    margin: 0; background-color: white; z-index: 11; mix-blend-mode: screen; 
    display: grid; grid-template-columns: 20vw 60vw 20vw; grid-template-rows: 30% 40% 30%; justify-items: center;
    grid-template-areas:
		". ttlogo ."
		"   .    ttlogo    .   "
		"   .     ttlogo      .   ";}
#info{position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; 
    margin: 0; z-index: 12;
    display: grid; grid-template-columns: 20vw 60vw 20vw; grid-template-rows: 30% calc(70% - 80px) 80px; grid-template-areas:
		"numb . credit"
		"   when    .    credit   "
		"   cplogo     .      caption   ";}
#numb{grid-area: numb; font-size: 20px; font-weight: 600; color: #98CADA; margin-top: 80px;margin-left: 80px; line-height: 150%;}
#when{
  
  grid-area: when;
  font-size: 16px;
  font-weight: 400;
  color: #113340;
  margin-left: 80px;
  line-height: 150%;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}#credit{grid-area: credit; display: grid; grid-template-columns: 30% 70%; grid-template-areas:"job name";
font-size: 16px; font-weight: 400; color: #113340; line-height: 180%; margin-top: 80px;}
#caption{ grid-area: caption; font-size: 14px; font-weight: 400; color: #113340; margin-right: 80px; line-height: 150%; justify-items: baseline;}
#cplogo{grid-area: cplogo;     height: 40px;  content: url(./resource/cplogo.svg); margin-left: 80px;}

.ttlogo{ grid-area: ttlogo; content: url(./resource/title.svg); height:calc(100vh - 160px); margin: 80px; align-items: center; transform: translateX(-50px) perspective(10000px);   transform-origin: center center;
    transition: transform 0.1s ease-out;
  will-change: transform;
}


#bg5{
  background-image: url("./resource/after2.jpeg");
  background-size: cover;
  background-position: center;
  position: relative;
  height: auto;
}
#bg5::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  /* Uniform dim overlay only (no top gradient) */
  background-color: rgba(17,51,64,0.5);
  z-index: 1;
  pointer-events: none; /* 클릭 방해 안 함 */
}

#bg5::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 200px;
  pointer-events: none;
  z-index: 2;
  background: linear-gradient(
    to bottom,
    rgba(17,51,64,0) 0%,
    #113340 100%
  );
}

/* Bottom gradient for bg4 (200px, transparent -> #113340) */
#bg4 { position: relative; }
#bg4::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 200px;
  pointer-events: none;
  z-index: 2;
  background: linear-gradient(to bottom, rgba(17,51,64,0) 0%, rgba(17,51,64,0.5) 100%);
}
#profile{width: calc(100vw - 160px); content: url(./resource/profile.svg); margin: auto; padding-top: 200px; padding-bottom: 300px; position: relative; z-index: 2;}


#bg6{background-color: #113340; height: 100vh;}




#before{ width: 60vw; mix-blend-mode: overlay; content: url(./resource/2040.svg);}
#after{ width: 60vw; mix-blend-mode: overlay; content: url(./resource/2060.svg);}

.year{     padding: 80px; position: sticky; align-items: center; margin: 0px; display: flex; align-items: flex-start; mix-blend-mode: overlay; width: calc(100vw - 160px);}

.col{     padding: 80px; position: sticky; top: 80px; align-items: center; margin: 0px; padding-top: 0px; display: flex; align-items: flex-start; mix-blend-mode: overlay; width: calc(100vw - 160px);}
.synop{margin-left: 40px; font-weight: 600; font-size: 20px; line-height: 150%; color: #CBE0E3; mix-blend-mode: overlay;}


.col-1{width: 20%;padding: 40px;}
.col-2{width: 40%;padding: 40px;}
.col-3{width: 60%;padding: 40px;}
.col-4{width: 80%;padding: 40px;}
.col-5{width: 100%;padding: 40px;}

.footer{align-items: center; display: flex;}
.footer_cap{width: 50%; color: #CBE0E3; line-height: 150%; margin-left: 10px; margin-top: 40px;}
.btn{
  border: 1px solid #CBE0E3;
  width: 100%;
  height: 80px;
  border-radius: 16px;
  text-align: center;
  color: #CBE0E3;
  line-height: 80px;
  margin-top: 16px;
  transition: background-color 0.3s, color 0.3s;
}

.btn:hover {
  background-color: #CBE0E3;
  color: #113340;
}
#star {
  position: fixed;
  top: 20%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px;
  height: 360px;
  background: url('./resource/star.svg') no-repeat center / contain;
  mix-blend-mode: plus-lighter;
  opacity: 0;                /* hidden by default */
  pointer-events: none;      /* non-interactive */
  transition: opacity .35s ease; /* fade in/out */
  z-index: 999;
}

/* ===== Scroll Snap Fixes (added) ===== */
/* Make sure the actual scroll container has snap enabled */

/* Ensure each section is exactly one viewport tall so it snaps like pages */
section.imgbg {
  height: 100vh;          /* override earlier 150vh/200vh with a fixed viewport height */
  min-height: 100vh;      /* keep safety */
}

/* If there's a fixed header in the future, reserve space so snap aligns nicely */
/* body { scroll-padding-top: 0; } */

/* iOS/Safari workaround: background-attachment: fixed can break snapping */
@supports (-webkit-touch-callout: none) {
  .imgbg { background-attachment: scroll; }
}

/* Optional: tighten the feel of snapping on momentum scroll */
section.imgbg { scroll-snap-align: start; scroll-snap-stop: always; }

/* Selection colors only inside bg2 and bg4 */
#bg2 ::selection,
#bg4 ::selection { 
  background: #113340; /* deep teal */
  color: #CBE0E3;      /* light sky */
}

/* Firefox prefix */
#bg2 ::-moz-selection,
#bg4 ::-moz-selection { 
  background: #113340;
  color: #CBE0E3;
}

#footer_col{display: flex; flex-direction: column; height: 100vh; justify-content: center; width: 300px; margin: auto;}
#book1, #book2 { cursor: pointer; }





@media (max-width: 1024px) {


   #title {
    width: 100vw;
    margin: 0;
    grid-template-columns: 50% 50%;
    grid-template-rows: 15% 75% 10%;
    grid-template-areas:
	" . . "
  "ttlogo ttlogo"
  " .  . ";
align-items: start;
   }
.ttlogo{height: 75vh; width: calc(100vw - 160px); margin: auto;}
#credit{display: none;}
#info{
  grid-template-columns: 50% 50%;
  grid-template-areas:
        "numb when"
        " . . "
        " cplogo caption ";
}
#when{margin-top: 40px; margin-left: 0; align-items: normal;}
#numb{margin-top: 40px;}
.year{padding: 24px; width: calc(100vw - 48px);
  flex-direction: column;}
#before, #after {width: 100%;}


  .synop {
    margin-left: 0;
    margin-top: 20px;
    line-height: 1.5;
  }
  #profile{content: url(./resource/m_profile.svg); max-width: 400px;}

  #footer_col{max-width: 300px;}
}

/*---------------mobile---------------*/
/* === Mobile (<= 768px) === */
@media (max-width: 768px) {

  /* 섹션: 여백 조금, 세로 꽉 찬 느낌 유지 */
  section.imgbg {
    min-height: 100vh; /* 페이지감 유지 */
  }

  /* 타이틀 영역: 그리드 → 단일 컬럼 느낌 */
  #title {

            width: 100vw;
        grid-template-columns: 50% 50%;
        grid-template-rows: 10% 80% 10%;
        grid-template-areas:
        " . . "
  "ttlogo ttlogo"
  " .  . ";

  }
  .ttlogo {
    width: 90vw;
    margin: 5vw;
    transform: none;                 /* 모바일에선 3D 기울임 제거 */
    transition: none;
  }

  /* 인포 영역: 단일 컬럼으로 재배치 */
  #info {
    width: calc(100vw - 48px);
    margin: 24px;
    grid-template-columns: 50% 50%;
    grid-template-rows: 15% 75% 10%;
    grid-template-areas:
	" numb when "
  " . . "
  " cplogo  cplogo ";
    align-items: start;
    grid-template-rows: 15vh 75vh 10vh;
  }
  #numb, #when, #credit, #caption { margin: 0; }
  #caption{display: none;}
  #when { margin-left: 0px;}
  #credit {
   display: none;
  }
  #cplogo{margin: auto; margin-bottom: 10vh; }

  /* 스티키 섹션: 모바일에선 고정보다 흐르게 */
  #bg2, #bg4 { min-height: auto; }
  .col {
    position: static;   /* sticky 해제 */
    top: auto;
    padding: 24px 16px;
    align-items: flex-start;
  }
  .synop{font-size: 16px;}

  /* 버튼 터치 영역/비주얼 */
  .btn {
    height: 56px;
    line-height: 56px;
    border-radius: 12px;
    font-size: 16px;
  }

  /* 스타: 모바일에선 시야 분산 줄이려 숨김(원하면 지워도 됨) */
  #star { height: 240px;}

  /* 텍스트 크기 약간 다운(선택) */
  #numb { font-size: 18px; }
  #when, #credit, #caption { font-size: 14px; }

#profile{width: calc(100vw - 48px); min-width: 330px;  content: url(./resource/m_profile.svg);}

#footer_col{width: calc(100vw - 48px); }
}



/* --- Dedicated scroll container to eliminate viewport overscroll bounce --- */
html, body { height: 100%; overflow: hidden; }
#scroller {
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden; /* added */
  overscroll-behavior-y: contain; /* prevent bounce at top/bottom */
  scroll-snap-type: y mandatory;  /* move snap to the container */
  -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
}




/* === Force light theme; disable dark-mode overrides === */
:root, html, body { color-scheme: light !important; }

@media (prefers-color-scheme: dark) {
  :root, html, body { color-scheme: light !important; }
  /* Ensure our intended background isn’t auto-darkened */
  body { background-color: #113340 !important; }
}

/* Prevent any auto inversion on media in some UAs */
img, picture, video, canvas {
  filter: none !important;
}

/* === Preloader (covers entire viewport until all assets load) === */
#preloader {
  position: fixed;
  inset: 0;
  background-color: #113340;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 14px;
  color: #CBE0E3;
  font-weight: 600;
  z-index: 99999;
  opacity: 1;
}
#preloader.fade-out {
  opacity: 0;
  transition: opacity .5s ease;
  pointer-events: none;
}
#preloader .spinner {
  width: 44px;
  height: 44px;
  border: 4px solid rgba(203,224,227,0.35);
  border-top-color: #CBE0E3;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
#preloader .loading-text { margin: 0; }
@keyframes spin { to { transform: rotate(360deg); } }




/* === Global fixed background (iOS-safe) === */
#fixed-bg { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
#fixed-bg .layer {
  position: absolute; inset: 0;
  background: center/cover no-repeat;
  opacity: 0; transition: opacity .6s ease;
  will-change: opacity, background-image, transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}
#fixed-bg .layer.show { opacity: 1; }

#fixed-dim { position: fixed; inset: 0; z-index: 0;
  background: rgba(0,0,0,0); pointer-events: none;
  transition: background-color .25s ease;
  will-change: background-color;
}

/* 글로벌 고정 배경을 쓰는 동안, 섹션 자체 배경은 끄기 (중복 방지) */
html.use-fixed-bg .imgbg {
  background-image: none !important;
  background-attachment: scroll !important;
}

/* #bg1만 섹션 배경 살리기 */
html.use-fixed-bg #bg1.imgbg {
  background-image: url("./resource/after.jpeg") !important;
  background-size: cover;
  background-position: center;
  background-attachment: scroll; /* 사파리 깨짐 방지 */
}

/* 본문이 배경 위로 올라오도록 */
#scroller { position: relative; z-index: 1; }

</style>
 </head>
 <body>
<div id="preloader">
  <div class="spinner"></div>
  <p class="loading-text">Loading…</p>
</div>
<div id="fixed-bg"><div class="layer a"></div><div class="layer b"></div></div>
<div id="fixed-dim"></div>
<div id="scroller">
    <section class="imgbg" id="bg1">
        <!-- <div style="content: url(./resource/title.png);"></div> -->
         <div id="title">
            <div class="ttlogo"></div>
         </div>
         <div id="info">
            <div id="numb"> 서울과학기술대학교<br>중앙연극동아리 어의실험극회<br>제92회 정기공연</div>
            <div id="when"> 2025년 9월 3일 - 6일<br>서울과학기술대학교 <br>제1학생회관 3층 어의소극장</div>         
            <div id="cplogo"></div>
            <div id="credit"> 
                <div style="font-weight: 600; grid-area: job;">연출<br><br>조연출<br><br><br>기획장<br><br>배우<br><br><br><br><br><br>포스터<br><br>웹사이트</div> 
                <div style="grid-area: name;">이태경<br><br>강지민<br>손예지<br><br>이승재<br><br>김민경<br>이솔<br>박훈양<br>이은수<br>조승진<br><br>주가을<br><br>조가은</div>

            </div>         
         
            <div id="caption"> *  천체가 관측자에게 빠르게 접근할때 나타나는 파장 변화</div>         



         </div>
    </section>
    <section class="imgbg" id="bg2">
        <!-- <div style="position: fixed; top: 0; left: 0; z-index: 11; width: 100px; height: 100px; content: url(./resource/before.png);"></div> -->
        <div class="year">
            <div id="before"></div>
            <div class="synop">소행성 충돌 10년 전, 멸망을 앞둔 세계.<br>지영은 끝이 정해진 시간 속에서, <br>아이를 낳을 것인가를 두고 마지막 선택 앞에 선다.</div>
        </div>
        </section>
    <section class="imgbg" id="bg3">
        <div style=" margin-top: 100px; display: flex; justify-content: center; ">
            <div id="star"></div>        
        </div>    
    </section>
    <section class="imgbg" id="bg4">
        <div class="year">
             <div id="after"></div>
             <div class="synop" style="color: #113340;">소행성 충돌 10년 후, 문명이 붕괴된 세계.<br> 기억을 잃은 채 기적적으로 생존한 소녀는 <br>반려로봇 '아루'와 기억을 되찾기 위해 고군분투 한다.</div>
        </div>
    </section>
    <section class="imgbg" id="bg5">
        <div id="profile"></div>
    </section>
    <section class="imgbg" id="bg6">
        <div id="footer_col"><div style="width: 48%; content: url(./resource/footer.svg);"></div>
            <div class="footer">
                <div class="footer_cap">서울과학기술대학교<br>제1학생회관 3층<br>어의소극장</div>
                <div class="footer_cap">2025년 9월<br>3-5일  19:00<br>6일  14:00, 18:00</div>
            </div>
            <div style="font-size: 14px; color: #CBE0E3; margin-top: 32px;">*  본 공연은 <b>무료공연</b>입니다.</div>
            <div class="btn" id="book1">일반 예매</div>
            <div class="btn" id="book2">노원구민 예매</div>
        </div>
    </section>
 </div>
<script>
// 링크 새 탭으로 열기
document.addEventListener('DOMContentLoaded', () => {
  const book1 = document.getElementById('book1');
  const book2 = document.getElementById('book2');

  function bind(btn, url) {
    if (!btn) return;
    btn.setAttribute('role', 'button');
    btn.setAttribute('tabindex', '0');
    const open = () => window.open(url, '_blank', 'noopener,noreferrer');
    btn.addEventListener('click', open);
    btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        open();
      }
    });
  }

  bind(book1, 'https://forms.gle/b6YnXp4om7Mfb1rHA');
  bind(book2, 'https://forms.gle/Av4WiJr5UPbTdiCo6');
});

// === Tilt + star visibility (moved in from stray script) ===
{
  const constrain = 300; // 기울기 민감도
  const moveFactor = 20; // XY 이동 민감도(px)
  const ex1Layer = document.querySelector('.ttlogo');
  if (ex1Layer) {
    // Detect touch/mobile (no hover, coarse pointer or touch-capable device)
    const isTouchEnv = (
      (window.matchMedia && window.matchMedia('(hover: none) and (pointer: coarse)').matches) ||
      navigator.maxTouchPoints > 0 ||
      navigator.msMaxTouchPoints > 0
    );

    if (!isTouchEnv) {
      function transforms(x, y, el) {
        const box = el.getBoundingClientRect();
        const calcX = -(y - box.top  - box.height / 2) / constrain;
        const calcY =  (x - box.left - box.width  / 2) / constrain;
        const moveX = (x - (box.left + box.width / 2)) / moveFactor;
        const moveY = (y - (box.top  + box.height / 2)) / moveFactor;
        return `
          perspective(1000px)
          rotateX(${calcX}deg)
          rotateY(${calcY}deg)
          translateX(${moveX}px)
          translateY(${moveY}px)
        `;
      }
      window.addEventListener('mousemove', (e) => {
        const xy = [e.clientX, e.clientY, ex1Layer];
        window.requestAnimationFrame(() => { ex1Layer.style.transform = transforms(...xy); });
      });
    } else {
      // On touch/mobile, make sure no transform updates happen
      ex1Layer.style.transform = 'none';
    }
  }

  window.history.scrollRestoration = 'manual';
  window.scrollTo(0, 0);

  const star = document.getElementById('star');
  const bg3  = document.getElementById('bg3');
  if (star && bg3) {
    const observer = new IntersectionObserver((entries) => {
      const entry = entries[0];
      star.style.opacity = entry.isIntersecting ? '1' : '0';
    }, { threshold: 0.6, root: document.getElementById('scroller') || null });
    observer.observe(bg3);
  }
}

// === Typing effect for .synop when its section snaps into view ===
(() => {
  const synops = Array.from(document.querySelectorAll('.synop'));
  if (!synops.length) return;

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const timers = new Map();

  // Ensure all relevant sections have no data-synop-active attribute initially
  const sections = new Set(
    synops.map(el => el.closest('section.imgbg')).filter(Boolean)
  );
  sections.forEach(sec => {
    if (sec) sec.removeAttribute('data-synop-active');
  });

  // store original and clear
  synops.forEach(el => {
    if (el.dataset.synopPrepared) return;
    el.dataset.synopPrepared = '1';
    el.dataset.originalHtml = el.innerHTML;
    el.innerHTML = '';
  });

  function typeIn(el) {
    if (el.dataset.typing === '1') return;
    el.dataset.typing = '1';
    const original = (el.dataset.originalHtml || '').replace(/\r\n|\r|\n/g, '\n');
    const text = original.replace(/<br\s*\/?>(\s*)/gi, '\n');
    let i = 0;
    const baseDelay = prefersReduced ? 0 : 22;
    function step() {
      if (!el.dataset.typing) return;
      const chunk = text.slice(0, i);
      el.innerHTML = chunk.replace(/\n/g, '<br>');
      if (i >= text.length) { el.dataset.typing = ''; timers.delete(el); return; }
      i++;
      const prev = text[i - 1];
      let delay = baseDelay;
      if (prev === '\n') delay += 120; else if (/[.,!?…]/.test(prev)) delay += 60;
      const id = window.setTimeout(step, delay);
      timers.set(el, id);
    }
    step();
  }

  function reset(el) {
    const id = timers.get(el); if (id) window.clearTimeout(id);
    timers.delete(el);
    el.dataset.typing = '';
    el.innerHTML = '';
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const section = entry.target;
      const synop = section.querySelector('.synop');
      if (!synop) return;

      if (prefersReduced) {
        if (entry.isIntersecting) {
          synop.innerHTML = (synop.dataset.originalHtml || '');
        }
        return;
      }

      if (entry.isIntersecting && entry.intersectionRatio >= 0.6) {
        if (section.dataset.synopActive === 'true') return; // already active, skip
        section.dataset.synopActive = 'true';
        reset(synop);
        typeIn(synop);
      } else {
        section.dataset.synopActive = 'false';
        reset(synop);
      }
    });
  }, { threshold: 0.6, root: document.getElementById('scroller') || null });

  sections.forEach(sec => observer.observe(sec));
})();



// === Global fixed background switcher (iOS-safe) + dim opacity ===
(() => {
  const scroller = document.getElementById('scroller');
  const fixed = document.getElementById('fixed-bg');
  const dim = document.getElementById('fixed-dim');
  if (!scroller || !fixed || !dim) return;

  // CSS 훅 활성화: 섹션 배경 끄기
  document.documentElement.classList.add('use-fixed-bg');

  // 두 장 레이어로 크로스페이드
  const layers = fixed.querySelectorAll('.layer');
  let cur = 0;

  // 섹션 ID → 배경 이미지 매핑 (너의 파일 경로 그대로)
  const map = {
    bg1: './resource/after.jpeg',
    bg2: './resource/before.jpeg',
    bg3: './resource/night.jpeg',
    bg4: './resource/after.jpeg',
  };

  function setBg(url){
    const next = layers[1 - cur];
    next.style.backgroundImage = `url('${url}')`;
    next.classList.add('show');
    layers[cur].classList.remove('show');
    cur = 1 - cur;
  }

  // 어떤 섹션이 보이는지 감지 (스냅 컨테이너는 #scroller)
  const secs = Array.from(document.querySelectorAll('section.imgbg'));
  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting && e.intersectionRatio >= 0.6) {
        const id = e.target.id;
        if (map[id]) setBg(map[id]);
      }
    });
  }, { threshold: [0.6], root: scroller });
  secs.forEach(s => io.observe(s));

  // 초기 배경
  if (secs[0] && map[secs[0].id]) {
    layers[cur].style.backgroundImage = `url('${map[secs[0].id]}')`;
    layers[cur].classList.add('show');
  }

  // 스크롤 진행도에 따라 딤(opacity) 조절
  const MAX = 0.1; // 최대 불투명도
  function updateDim(){
    const vh = scroller.clientHeight;
    let activeRect = null;
    for (const s of secs) {
      const r = s.getBoundingClientRect();
      if (r.bottom > 0 && r.top < vh) { activeRect = r; break; }
    }
    if (!activeRect) return;
    const visible = Math.min(Math.max((vh - activeRect.top) / vh, 0), 1);
    const opacity = Math.min(visible * MAX, MAX);
    dim.style.backgroundColor = `rgba(0,0,0,${opacity.toFixed(3)})`;
  }
  scroller.addEventListener('scroll', updateDim, { passive: true });
  updateDim();
})();

// === Hide preloader after all assets (images, fonts) are loaded ===
window.addEventListener('load', function() {
  const preloader = document.getElementById('preloader');
  if (!preloader) return;
  preloader.classList.add('fade-out');
  setTimeout(() => { preloader.style.display = 'none'; }, 550);
});



</script>
</body>
</html>